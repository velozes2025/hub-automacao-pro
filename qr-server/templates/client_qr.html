<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conectar WhatsApp - {{ empresa.nome }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="qr-container">
        <h1 style="color:#25d366;margin-bottom:8px;">{{ empresa.nome }}</h1>
        <p style="color:#888;margin-bottom:24px;">Escaneie o QR code com seu WhatsApp</p>
        <div id="qr-area">
            <p style="color:#666;">Carregando QR code...</p>
        </div>
        <div id="qr-status" class="qr-status waiting" style="margin-top:16px;"></div>
        <button onclick="loadQR()" class="btn btn-primary" style="margin-top:16px;">Atualizar QR Code</button>
    </div>

    <script>
    let refreshTimer = null;

    function loadQR() {
        fetch('/api/qr/{{ token }}')
            .then(r => r.json())
            .then(data => {
                const area = document.getElementById('qr-area');
                const status = document.getElementById('qr-status');

                if (data.state === 'open') {
                    area.innerHTML = '<div style="font-size:3em;">&#9989;</div>';
                    status.textContent = 'CONECTADO';
                    status.className = 'qr-status connected';
                    if (refreshTimer) clearInterval(refreshTimer);
                } else if (data.base64) {
                    area.innerHTML = '<img src="' + data.base64 + '" alt="QR Code">';
                    status.textContent = 'AGUARDANDO SCAN...';
                    status.className = 'qr-status waiting';
                } else {
                    area.innerHTML = '<p style="color:#e74c3c;">QR code nao disponivel. Clique em Atualizar.</p>';
                    status.textContent = '';
                }
            })
            .catch(() => {
                document.getElementById('qr-status').textContent = 'Erro ao carregar';
            });
    }

    loadQR();
    refreshTimer = setInterval(loadQR, 20000);
    </script>
</body>
</html>
